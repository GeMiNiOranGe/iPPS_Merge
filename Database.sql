CREATE DATABASE QUANLYLUONG
GO

USE QUANLYLUONG
GO

-- TẠO BẢNG TÀI KHOẢN
CREATE TABLE TAIKHOAN (
	USERNAME VARCHAR(10) PRIMARY KEY,
	PASSWORD NVARCHAR(30) NOT NULL,
)
INSERT TAIKHOAN VALUES ('Admin', 'admin123')

-- TẠO BẢNG PHÒNG BAN
CREATE TABLE PHONGBAN (
    MAPB VARCHAR(10) PRIMARY KEY,
    TENPB NVARCHAR(50),
    DIACHI NVARCHAR(100),
)
INSERT PHONGBAN VALUES ('PB001', N'Phòng ban ABC', N'TP Hồ Chí Minh')
INSERT PHONGBAN VALUES ('PB002', N'Phòng ban EFG', N'Bình Dương')
INSERT PHONGBAN VALUES ('PB003', N'Phòng ban HKJ', N'Đồng Nai')

-- TẠO BẢNG CHỨC VỤ
CREATE TABLE CHUCVU (
    MACV VARCHAR(10) PRIMARY KEY,
    TENCV NVARCHAR(50),
    HESOPHUCAP DECIMAL(10,1), -- HỆ SỐ PHỤ CẤP
    MAPB VARCHAR(10),

    FOREIGN KEY(MAPB) REFERENCES PHONGBAN(MAPB),
)
INSERT CHUCVU VALUES ('CV001', N'Quản lý', 3, 'PB001')
INSERT CHUCVU VALUES ('CV002', N'Kế toán', 2, 'PB002')
INSERT CHUCVU VALUES ('CV003', N'Kiểm toán', 2, 'PB003')
INSERT CHUCVU VALUES ('CV004', N'Trưởng phòng', 2.2, 'PB002')
INSERT CHUCVU VALUES ('CV005', N'Nhân viên Content Marketing', 3, 'PB001')
INSERT CHUCVU VALUES ('CV006', N'Nhân viên bán hàng', 3, 'PB001')
INSERT CHUCVU VALUES ('CV007', N'Nhân viên kỹ thuật', 3, 'PB003')

-- TẠO BẢNG NGẠCH LƯƠNG
CREATE TABLE NGACHLUONG (
    MANL VARCHAR(10) PRIMARY KEY,
	TENNL NVARCHAR(20),
    MOTA NVARCHAR(100),
)
INSERT NGACHLUONG VALUES ('NL001', N'Ngạch lương I', null)
INSERT NGACHLUONG VALUES ('NL002', N'Ngạch lương II', null)
INSERT NGACHLUONG VALUES ('NL003', N'Ngạch lương III', null)
INSERT NGACHLUONG VALUES ('NL004', N'Ngạch lương IV', null)
INSERT NGACHLUONG VALUES ('NL005', N'Ngạch lương V', null)

-- TẠO BẢNG BẬC LƯƠNG
CREATE TABLE BACLUONG (
    MABL VARCHAR(10) PRIMARY KEY,
	TENBL NVARCHAR(20),
    HESOBL DECIMAL(10,1),
    MOTA NVARCHAR(100),
    MANL VARCHAR(10),

    FOREIGN KEY(MANL) REFERENCES NGACHLUONG(MANL),
)
INSERT BACLUONG VALUES ('BL001', N'Bậc lương I', 6.20, null, 'NL001')
INSERT BACLUONG VALUES ('BL002', N'Bậc lương II', 6.56, null, 'NL002')
INSERT BACLUONG VALUES ('BL003', N'Bậc lương III', 6.92, null, 'NL003')
INSERT BACLUONG VALUES ('BL004', N'Bậc lương IV', 7.28, null, 'NL004')
INSERT BACLUONG VALUES ('BL005', N'Bậc lương V', 7.56, null, 'NL005')

-- TẠO BẢNG NHÂN VIÊN
CREATE TABLE NHANVIEN (
    MANV VARCHAR(10) PRIMARY KEY,
    HOTENNV NVARCHAR(50),
    GIOITINH BIT,
    NGAYSINH DATE,
    NOISINH NVARCHAR(50),
    QUEQUAN NVARCHAR(50),
    TRINHDOVANHOA CHAR(10), -- TRÌNH ĐỘ VĂN HOÁ
    DANTOC NVARCHAR(20),
    TONGIAO NVARCHAR(20),
    DOANVIEN BIT,
    DANGVIEN BIT,
    CONGDOANVIEN BIT, -- CÔNG ĐOÀN VIÊN
    MAPB VARCHAR(10),
    MACV VARCHAR(10),
    MANL VARCHAR(10),
    MABL VARCHAR(10),

    FOREIGN KEY(MAPB) REFERENCES PHONGBAN(MAPB),
    FOREIGN KEY(MACV) REFERENCES CHUCVU(MACV),
    FOREIGN KEY(MANL) REFERENCES NGACHLUONG(MANL),
    FOREIGN KEY(MABL) REFERENCES BACLUONG(MABL),
)
INSERT NHANVIEN VALUES ('NV00001', N'Lê Thị Bình', 0, '19920301', N'Bình Dương', N'Bình Dương', '12/12', N'Kinh', N'Đạo Phật', 1, 1, 1, 'PB001', 'CV001', 'NL001', 'BL001')
INSERT NHANVIEN VALUES ('NV00002', N'Trần Khánh Vân', 0, '19970705', N'Bình Thuận', N'Bình Thuận', '12/12', N'Kinh', N'Đạo Phật', 1, 0, 1, 'PB002', 'CV002', 'NL002', 'BL002')
INSERT NHANVIEN VALUES ('NV00003', N'Lê Tấn Đạt', 1, '20001030', N'Bình Định', N'Bình Định', '12/12', N'Kinh', N'Đạo Phật', 1, 0, 0, 'PB003', 'CV003', 'NL003', 'BL003')
INSERT NHANVIEN VALUES ('NV00004', N'Nguyễn Duy Khang', 1, '19990328', N'Biên Hòa', N'Biên Hòa', '12/12', N'Kinh', N'Đạo Phật', 1, 1, 0, 'PB002', 'CV004', 'NL004', 'BL004')
INSERT NHANVIEN VALUES ('NV00005', N'Nguyễn Phương Nhi', 0, '20010710', N'Phú Yên', N'Phú Yên', '12/12', N'Kinh', N'Đạo Phật', 1, 1, 1, 'PB001', 'CV005', 'NL005', 'BL005')
INSERT NHANVIEN VALUES ('NV00006', N'Đỗ Thị Hà', 0, '20010309', N'Phú Yên', N'Phú Yên', '12/12', N'Kinh', N'Đạo Phật', 1, 1, 1, 'PB001', 'CV005', 'NL001', 'BL001')
INSERT NHANVIEN VALUES ('NV00007', N'Đoàn Thiên Ân', 0, '20020710', N'Long An', N'Long An', '12/12', N'Kinh', N'Đạo Phật', 1, 1, 1, 'PB001', 'CV005', 'NL002', 'BL002')
INSERT NHANVIEN VALUES ('NV00008', N'Huỳnh Thanh Thủy', 0, '20031106', N'Đà Nẵng', N'Đà Nẵng', '12/12', N'Kinh', N'Đạo Phật', 1, 1, 1, 'PB001', 'CV006', 'NL002', 'BL002')
INSERT NHANVIEN VALUES ('NV00009', N'Nguyễn Hải Nam', 1, '20000709', N'Phú Yên', N'Phú Yên', '12/12', N'Kinh', N'Đạo Phật', 1, 1, 1, 'PB001', 'CV006', 'NL005', 'BL005')
INSERT NHANVIEN VALUES ('NV00010', N'Lê Duy Khánh', 1, '20010911', N'Hà Nội', N'Hà Nội', '12/12', N'Kinh', N'Đạo Phật', 1, 1, 1, 'PB001', 'CV006', 'NL005', 'BL005')
INSERT NHANVIEN VALUES ('NV00011', N'Trịnh Thùy Linh', 0, '20030719', N'Hải Phòng', N'Hải Phòng', '12/12', N'Kinh', N'Đạo Phật', 1, 1, 1, 'PB003', 'CV007', 'NL001', 'BL001')
INSERT NHANVIEN VALUES ('NV00012', N'Lê Nguyễn Ngọc Hằng', 0, '20030720', N'Hồ Chí Minh', N'Hồ Chí Minh', '12/12', N'Kinh', N'Đạo Phật', 0, 1, 1, 'PB003', 'CV007', 'NL002', 'BL002')
INSERT NHANVIEN VALUES ('NV00013', N'Lê Minh Anh', 1, '20030823', N'Bình Định', N'Bình Định', '12/12', N'Kinh', N'Đạo Phật', 1, 1, 1, 'PB003', 'CV007', 'NL001', 'BL001')
INSERT NHANVIEN VALUES ('NV00014', N'Lê Kim Hung', 1, '20030823', N'Bình Định', N'Bình Định', '12/12', N'Kinh', N'Đạo Phật', 1, 0, 1, 'PB003', 'CV007', 'NL001', 'BL001')

-- TẠO BẢNG NGƯỜI THÂN
CREATE TABLE NGUOITHAN (
    MANT VARCHAR(10) PRIMARY KEY,
	LOAINT NVARCHAR(30), 
    HOTEN NVARCHAR(50),
    NGAYSINH DATE,
    NGHENGHIEP NVARCHAR(50),
    MANV VARCHAR(10),

    FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV),
)
INSERT NGUOITHAN VALUES ('NT001', N'Cha', N'Lê Văn Tám', '19630427', N'Bán tạp hoá', 'NV00001')
INSERT NGUOITHAN VALUES ('NT002', N'Mẹ', N'Nguyễn Thị Chín', '19690428', N'Kinh doanh', 'NV00001') 
INSERT NGUOITHAN VALUES ('NT003', N'Cha', N'Trần Hữu Nghĩa', '19670927', N'Kinh doanh', 'NV00002')
INSERT NGUOITHAN VALUES ('NT004', N'Mẹ', N'Nguyễn Thị Bé', '19731027', N'Bán tạp hoá', 'NV00002') 
INSERT NGUOITHAN VALUES ('NT005', N'Cha', N'Lê Văn Khánh', '19800430', N'Ngư nghiệp', 'NV00003') 
INSERT NGUOITHAN VALUES ('NT006', N'Mẹ', N'Trần Tuyết Nhung', '19810506', N'Nông nghiệp', 'NV00004') 
INSERT NGUOITHAN VALUES ('NT007', N'Mẹ', N'Nguyễn Thị Chóng', '19770405', N'Công nhân', 'NV00004') 
INSERT NGUOITHAN VALUES ('NT008', N'Cha', N'Lê Văn Đông', '19650927', N'Kinh doanh', 'NV00005') 
INSERT NGUOITHAN VALUES ('NT009', N'Cha', N'Trần Văn Trọng', '19650927', N'Kinh doanh', 'NV00006')
INSERT NGUOITHAN VALUES ('NT010', N'Cha', N'Lê Văn Hòa', '19651022', N'Kinh doanh', 'NV00007')
INSERT NGUOITHAN VALUES ('NT011', N'Cha', N'Nguyễn Anh Dũng', '19690927', N'Kinh doanh', 'NV00008')
INSERT NGUOITHAN VALUES ('NT012', N'Cha', N'Nguyễn Văn Nam', '19700927', N'Kinh doanh', 'NV00009')
INSERT NGUOITHAN VALUES ('NT013', N'Cha', N'Lâm Văn Thủy', '19710927', N'Kinh doanh', 'NV00010')
INSERT NGUOITHAN VALUES ('NT014', N'Cha', N'Trần Duy Phước', '19650929', N'Kinh doanh', 'NV00011')
INSERT NGUOITHAN VALUES ('NT015', N'Cha', N'Lê Văn Mười', '19681027', N'Kinh doanh', 'NV00012')
INSERT NGUOITHAN VALUES ('NT016', N'Mẹ', N'Trần Thị Nhung', '19720127', N'Nông nghiệp', 'NV00013')

-- TẠO BẢNG CHUYÊN MÔN
CREATE TABLE CHUYENMON (
    MACM VARCHAR(10) PRIMARY KEY,
    TENCM NVARCHAR(50),
    TRINHDO CHAR(5),
)
INSERT CHUYENMON VALUES ('CM001', N'Quản lí phòng ban', 'A')
INSERT CHUYENMON VALUES ('CM002', N'Tính toán doanh thu', 'A')
INSERT CHUYENMON VALUES ('CM003', N'Kiểm tra - đối soát doanh thu', 'A')
INSERT CHUYENMON VALUES ('CM004', N'Quản lí nhân sự', 'A')
INSERT CHUYENMON VALUES ('CM005', N'Quảng cáo sản phẩm', 'A')
INSERT CHUYENMON VALUES ('CM006', N'Nhập bán hàng', 'A')
INSERT CHUYENMON VALUES ('CM007', N'Hỗ trợ - sữa chữa', 'A')

-- TẠO BẢNG NHÂN VIÊN - CHUYÊN MÔN
CREATE TABLE NHANVIEN_CHUYENMON (
    MANV VARCHAR(10) NOT NULL,
    MACM VARCHAR(10) NOT NULL,

    PRIMARY KEY(MANV, MACM),
    FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV),
    FOREIGN KEY(MACM) REFERENCES CHUYENMON(MACM),
)
INSERT NHANVIEN_CHUYENMON VALUES ('NV00001', 'CM001')
INSERT NHANVIEN_CHUYENMON VALUES ('NV00002', 'CM002')
INSERT NHANVIEN_CHUYENMON VALUES ('NV00003', 'CM003')
INSERT NHANVIEN_CHUYENMON VALUES ('NV00004', 'CM004')
INSERT NHANVIEN_CHUYENMON VALUES ('NV00005', 'CM005')
INSERT NHANVIEN_CHUYENMON VALUES ('NV00006', 'CM005')
INSERT NHANVIEN_CHUYENMON VALUES ('NV00007', 'CM005')
INSERT NHANVIEN_CHUYENMON VALUES ('NV00008', 'CM006')
INSERT NHANVIEN_CHUYENMON VALUES ('NV00009', 'CM006')
INSERT NHANVIEN_CHUYENMON VALUES ('NV00010', 'CM006')
INSERT NHANVIEN_CHUYENMON VALUES ('NV00011', 'CM007')
INSERT NHANVIEN_CHUYENMON VALUES ('NV00012', 'CM007')
INSERT NHANVIEN_CHUYENMON VALUES ('NV00013', 'CM007')

-- TẠO BẢNG NGOẠI NGỮ
CREATE TABLE NGOAINGU (
    MANN VARCHAR(10) PRIMARY KEY,
    TENNN NVARCHAR(50),
    TRINHDO CHAR(5),
)
INSERT NGOAINGU VALUES ('NN001', N'Toeic 450+', 450)
INSERT NGOAINGU VALUES ('NN002', N'Toeic 800+', 800)
INSERT NGOAINGU VALUES ('NN003', N'Toeic 650+', 650)
INSERT NGOAINGU VALUES ('NN004', N'Ielts 4.0', 4.0)
INSERT NGOAINGU VALUES ('NN005', N'Ielts 6.0', 6.0)

-- TẠO BẢNG NHÂN VIÊN - NGOẠI NGỮ
CREATE TABLE NHANVIEN_NGOAINGU (
    MANV VARCHAR(10) NOT NULL,
    MANN VARCHAR(10) NOT NULL,

    PRIMARY KEY(MANV, MANN),
    FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV),
    FOREIGN KEY(MANN) REFERENCES NGOAINGU(MANN),
)
INSERT NHANVIEN_NGOAINGU VALUES ('NV00001', 'NN001')
INSERT NHANVIEN_NGOAINGU VALUES ('NV00002', 'NN002')
INSERT NHANVIEN_NGOAINGU VALUES ('NV00003', 'NN003')
INSERT NHANVIEN_NGOAINGU VALUES ('NV00004', 'NN004')
INSERT NHANVIEN_NGOAINGU VALUES ('NV00005', 'NN005')
INSERT NHANVIEN_NGOAINGU VALUES ('NV00006', 'NN001')
INSERT NHANVIEN_NGOAINGU VALUES ('NV00007', 'NN003')
INSERT NHANVIEN_NGOAINGU VALUES ('NV00008', 'NN002')
INSERT NHANVIEN_NGOAINGU VALUES ('NV00009', 'NN005')
INSERT NHANVIEN_NGOAINGU VALUES ('NV00010', 'NN004')
INSERT NHANVIEN_NGOAINGU VALUES ('NV00011', 'NN004')
INSERT NHANVIEN_NGOAINGU VALUES ('NV00012', 'NN001')
INSERT NHANVIEN_NGOAINGU VALUES ('NV00013', 'NN005')

-- TẠO BẢNG PHÒNG TỔ CHỨC
CREATE TABLE PHONGTOCHUC (
    SOQUYETDINH VARCHAR(20) PRIMARY KEY,
    TENNGUOIKY NVARCHAR(50), -- TÊN NGƯỜI KÝ
    CHUCVUNGUOIKY VARCHAR(10), -- CHỨC VỤ NGƯỜI KÝ
    PHONGBANHIENTAI VARCHAR(10), -- PHÒNG BAN HIỆN TẠI
    PHONGBANTHUYENCHUYEN VARCHAR(10), -- PHÒNG BAN THUYÊN CHUYỂN

    FOREIGN KEY(CHUCVUNGUOIKY) REFERENCES CHUCVU(MACV),
    FOREIGN KEY(PHONGBANHIENTAI) REFERENCES PHONGBAN(MAPB),
    FOREIGN KEY(PHONGBANTHUYENCHUYEN) REFERENCES PHONGBAN(MAPB),  
)
INSERT PHONGTOCHUC VALUES ('1/13112023/QD-PB', N'Lê Thị Bình', 'CV001', 'PB001', 'PB002')
INSERT PHONGTOCHUC VALUES ('1/14112023/QD-PB', N'Lê Thị Bình', 'CV001', 'PB002', 'PB003')
INSERT PHONGTOCHUC VALUES ('1/15112023/QD-PB', N'Lê Thị Bình', 'CV001', 'PB003', 'PB001')
INSERT PHONGTOCHUC VALUES ('1/16112023/QD-PB', N'Lê Thị Bình', 'CV001', 'PB002', 'PB001')
INSERT PHONGTOCHUC VALUES ('1/17112023/QD-PB', N'Lê Thị Bình', 'CV001', 'PB001', 'PB003')

CREATE TABLE NHANVIEN_PHONGTOCHUC (
    MANV VARCHAR(10),
    SOQUYETDINH VARCHAR(20),

    PRIMARY KEY(MANV, SOQUYETDINH),
    FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV),
    FOREIGN KEY(SOQUYETDINH) REFERENCES PHONGTOCHUC(SOQUYETDINH),
)
INSERT NHANVIEN_PHONGTOCHUC VALUES ('NV00001', '1/13112023/QD-PB')
INSERT NHANVIEN_PHONGTOCHUC VALUES ('NV00002', '1/14112023/QD-PB')
INSERT NHANVIEN_PHONGTOCHUC VALUES ('NV00003', '1/15112023/QD-PB')
INSERT NHANVIEN_PHONGTOCHUC VALUES ('NV00004', '1/16112023/QD-PB')
INSERT NHANVIEN_PHONGTOCHUC VALUES ('NV00005', '1/17112023/QD-PB')
INSERT NHANVIEN_PHONGTOCHUC VALUES ('NV00006', '1/13112023/QD-PB')
INSERT NHANVIEN_PHONGTOCHUC VALUES ('NV00007', '1/14112023/QD-PB')
INSERT NHANVIEN_PHONGTOCHUC VALUES ('NV00008', '1/15112023/QD-PB')
INSERT NHANVIEN_PHONGTOCHUC VALUES ('NV00009', '1/16112023/QD-PB')
INSERT NHANVIEN_PHONGTOCHUC VALUES ('NV00010', '1/17112023/QD-PB')
INSERT NHANVIEN_PHONGTOCHUC VALUES ('NV00011', '1/13112023/QD-PB')
INSERT NHANVIEN_PHONGTOCHUC VALUES ('NV00012', '1/14112023/QD-PB')
INSERT NHANVIEN_PHONGTOCHUC VALUES ('NV00013', '1/15112023/QD-PB')

-- TẠO BẢNG PHÒNG BAN - PHÒNG TỔ CHỨC
CREATE TABLE PHONGBAN_PHONGTOCHUC (
    MAPB VARCHAR(10),
    SOQUYETDINH VARCHAR(20),

    PRIMARY KEY(MAPB, SOQUYETDINH),
    FOREIGN KEY(MAPB) REFERENCES PHONGBAN(MAPB),
    FOREIGN KEY(SOQUYETDINH) REFERENCES PHONGTOCHUC(SOQUYETDINH),
)
INSERT PHONGBAN_PHONGTOCHUC VALUES ('PB001', '1/13112023/QD-PB')
INSERT PHONGBAN_PHONGTOCHUC VALUES ('PB002', '1/14112023/QD-PB')
INSERT PHONGBAN_PHONGTOCHUC VALUES ('PB003', '1/15112023/QD-PB')
INSERT PHONGBAN_PHONGTOCHUC VALUES ('PB002', '1/16112023/QD-PB')
INSERT PHONGBAN_PHONGTOCHUC VALUES ('PB001', '1/17112023/QD-PB')

-- TẠO BẢNG HỘ GIA ĐÌNH
CREATE TABLE HOGIADINH (
	MAHGD VARCHAR(10) PRIMARY KEY,
	MANV1 VARCHAR(10),
	MANV2 VARCHAR(10),

	FOREIGN KEY(MANV1) REFERENCES NHANVIEN(MANV),
	FOREIGN KEY(MANV2) REFERENCES NHANVIEN(MANV)
)
INSERT HOGIADINH VALUES ('P001', 'NV00001', 'NV00014')
INSERT HOGIADINH VALUES ('P002', 'NV00002', NULL)
INSERT HOGIADINH VALUES ('P003', 'NV00003', NULL)
INSERT HOGIADINH VALUES ('P004', 'NV00004', NULL)
INSERT HOGIADINH VALUES ('P005', 'NV00005', NULL)
INSERT HOGIADINH VALUES ('P006', 'NV00006', NULL)
INSERT HOGIADINH VALUES ('P007', 'NV00007', NULL)
INSERT HOGIADINH VALUES ('P008', 'NV00008', 'NV00011')
INSERT HOGIADINH VALUES ('P009', 'NV00009', 'NV00012')
INSERT HOGIADINH VALUES ('P010', 'NV00010', 'NV00013')

-- TẠO BẢNG ĐIỆN
CREATE TABLE DIEN (
    MAD VARCHAR(10) PRIMARY KEY,
	MAHGD VARCHAR(10),
    THANG DATE,
    HESOTHANGTRUOC INT,
    HESOHIENTAI INT,
    DONVI char(5),

	FOREIGN KEY(MAHGD) REFERENCES HOGIADINH(MAHGD)
)
INSERT DIEN VALUES ('D0001', 'P001', '20231101', 0, 102, 'kW')
INSERT DIEN VALUES ('D0002', 'P002', '20231101', 0, 103, 'kW')
INSERT DIEN VALUES ('D0003', 'P003', '20231101', 0, 104, 'kW')
INSERT DIEN VALUES ('D0004', 'P004', '20231101', 0, 105, 'kW')
INSERT DIEN VALUES ('D0005', 'P005', '20231101', 0, 106, 'kW')
INSERT DIEN VALUES ('D0006', 'P006', '20231101', 0, 102, 'kW')
INSERT DIEN VALUES ('D0007', 'P007', '20231101', 0, 103, 'kW')
INSERT DIEN VALUES ('D0008', 'P008', '20231101', 0, 104, 'kW')
INSERT DIEN VALUES ('D0009', 'P009', '20231101', 0, 105, 'kW')
INSERT DIEN VALUES ('D0010', 'P010', '20231101', 0, 106, 'kW')

-- TẠO BẢNG NƯỚC
CREATE TABLE NUOC (
    MAN VARCHAR(10) PRIMARY KEY,
	MAHGD VARCHAR(10),
    THANG DATE,
    HESOTHANGTRUOC INT,
    HESOHIENTAI INT,
    DONVI char(5),

	FOREIGN KEY(MAHGD) REFERENCES HOGIADINH(MAHGD)
)
INSERT NUOC VALUES ('N0001', 'P001', '20231101', 0, 12, 'm3')
INSERT NUOC VALUES ('N0002', 'P002', '20231101', 0, 13, 'm3')
INSERT NUOC VALUES ('N0003', 'P003', '20231101', 0, 14, 'm3')
INSERT NUOC VALUES ('N0004', 'P004', '20231101', 0, 15, 'm3')
INSERT NUOC VALUES ('N0005', 'P005', '20231101', 0, 16, 'm3')
INSERT NUOC VALUES ('N0006', 'P006', '20231101', 0, 12, 'm3')
INSERT NUOC VALUES ('N0007', 'P007', '20231101', 0, 13, 'm3')
INSERT NUOC VALUES ('N0008', 'P008', '20231101', 0, 14, 'm3')
INSERT NUOC VALUES ('N0009', 'P009', '20231101', 0, 15, 'm3')
INSERT NUOC VALUES ('N0010', 'P010', '20231101', 0, 16, 'm3')

-- TẠO BẢNG TIENNHA
CREATE TABLE TIENNHA (
    MANTT VARCHAR(10) PRIMARY KEY,
	MAHGD VARCHAR(10),
    THANG DATE,
    TIENNHA INT,
    MAD VARCHAR(10),
    MAN VARCHAR(10),
    TIENPHIVESINHANNINHTRATTU INT, -- TIỀN PHÍ VỆ SINH AN NINH TRẬT TỰ
	TONGTIEN INT

	FOREIGN KEY(MAHGD) REFERENCES HOGIADINH(MAHGD),
    FOREIGN KEY(MAD) REFERENCES DIEN(MAD),
    FOREIGN KEY(MAN) REFERENCES NUOC(MAN),
)


INSERT TIENNHA VALUES ('TN0001', 'P001', '20231101', 2500000, 'D0001', 'N0001', 50000)
INSERT TIENNHA VALUES ('TN0002', 'P002', '20231101', 2800000, 'D0002', 'N0002', 65000)
INSERT TIENNHA VALUES ('TN0003', 'P003', '20231101', 3000000, 'D0003', 'N0003', 50000)
INSERT TIENNHA VALUES ('TN0004', 'P004', '20231101', 2600000, 'D0004', 'N0004', 55000)
INSERT TIENNHA VALUES ('TN0005', 'P005', '20231101', 2900000, 'D0005', 'N0005', 60000)
INSERT TIENNHA VALUES ('TN0006', 'P006', '20231101', 2500000, 'D0006', 'N0006', 50000)
INSERT TIENNHA VALUES ('TN0007', 'P007', '20231101', 2800000, 'D0007', 'N0007', 65000)
INSERT TIENNHA VALUES ('TN0008', 'P008', '20231101', 3000000, 'D0008', 'N0008', 50000)
INSERT TIENNHA VALUES ('TN0009', 'P009', '20231101', 2600000, 'D0009', 'N0009', 55000)
INSERT TIENNHA VALUES ('TN0010', 'P010', '20231101', 2900000, 'D0010', 'N0010', 60000)

-- TẠO BẢNG BỘ PHẬN CHẤM CÔNG
CREATE TABLE BOPHANCHAMCONG (
    MACC VARCHAR(10) PRIMARY KEY,
    THANG DATE,
    SONGAYTRONGTHANG TINYINT, -- SỐ NGÀY TRONG THÁNG PHẢI ĐI LÀM
    SONGAYNGHIBHXH TINYINT, -- SỐ NGÀY NGHỈ BHXH
    SONGAYNGHIKHONGLYDO TINYINT, -- SỐ NGÀY NGHỈ KHÔNG LY DO
    MANV VARCHAR(10),

    FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV),
)
INSERT BOPHANCHAMCONG VALUES ('CC0001', '20231031', 27, 1, 3, 'NV00001')
INSERT BOPHANCHAMCONG VALUES ('CC0002', '20231031', 27, 1, 0, 'NV00002')
INSERT BOPHANCHAMCONG VALUES ('CC0003', '20231031', 27, 0, 1, 'NV00003')
INSERT BOPHANCHAMCONG VALUES ('CC0004', '20231031', 27, 2, 0, 'NV00004')
INSERT BOPHANCHAMCONG VALUES ('CC0005', '20231031', 27, 1, 2, 'NV00005')
INSERT BOPHANCHAMCONG VALUES ('CC0006', '20231031', 27, 1, 3, 'NV00006')
INSERT BOPHANCHAMCONG VALUES ('CC0007', '20231031', 27, 1, 0, 'NV00007')
INSERT BOPHANCHAMCONG VALUES ('CC0008', '20231031', 27, 0, 1, 'NV00008')
INSERT BOPHANCHAMCONG VALUES ('CC0009', '20231031', 27, 2, 0, 'NV00009')
INSERT BOPHANCHAMCONG VALUES ('CC0010', '20231031', 27, 1, 2, 'NV00010')
INSERT BOPHANCHAMCONG VALUES ('CC0011', '20231031', 27, 1, 3, 'NV00011')
INSERT BOPHANCHAMCONG VALUES ('CC0012', '20231031', 27, 1, 0, 'NV00012')
INSERT BOPHANCHAMCONG VALUES ('CC0013', '20231031', 27, 0, 1, 'NV00013')

-- TẠO BẢNG LƯƠNG
CREATE TABLE LUONG (
    MAL VARCHAR(10) PRIMARY KEY,
    THOIDIEM DATE,
    LUONGCOBAN INT,
    MANL VARCHAR(10),
    MABL VARCHAR(10),
    MACV VARCHAR(10),
    MACC VARCHAR(10),
    MATN VARCHAR(10), -- TIỀN NHÀ
    MANV VARCHAR(10),
	TIENLUONG INT DEFAULT 0

    FOREIGN KEY(MANL) REFERENCES NGACHLUONG(MANL),
    FOREIGN KEY(MABL) REFERENCES BACLUONG(MABL),
    FOREIGN KEY(MACV) REFERENCES CHUCVU(MACV),
    FOREIGN KEY(MACC) REFERENCES BOPHANCHAMCONG(MACC),
    FOREIGN KEY(MATN) REFERENCES TIENNHA(MANTT),
    FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV),
)
INSERT LUONG VALUES ('L0001', '20231101', 6000000, 'NL001', 'BL001', 'CV001', 'CC0001', 'TN0001', 'NV00001', 0)
INSERT LUONG VALUES ('L0002', '20231101', 5800000, 'NL002', 'BL002', 'CV002', 'CC0002', 'TN0002', 'NV00002', 0)
INSERT LUONG VALUES ('L0003', '20231101', 7000000, 'NL003', 'BL003', 'CV003', 'CC0003', 'TN0003', 'NV00003', 0)
INSERT LUONG VALUES ('L0004', '20231101', 6400000, 'NL004', 'BL004', 'CV004', 'CC0004', 'TN0004', 'NV00004', 0)
INSERT LUONG VALUES ('L0005', '20231101', 6500000, 'NL005', 'BL005', 'CV005', 'CC0005', 'TN0005', 'NV00005', 0)
INSERT LUONG VALUES ('L0006', '20231101', 6000000, 'NL001', 'BL001', 'CV005', 'CC0006', 'TN0006', 'NV00006', 0)
INSERT LUONG VALUES ('L0007', '20231101', 5800000, 'NL002', 'BL002', 'CV005', 'CC0007', 'TN0007', 'NV00007', 0)
INSERT LUONG VALUES ('L0008', '20231101', 7000000, 'NL002', 'BL002', 'CV006', 'CC0008', 'TN0008', 'NV00008', 0)
INSERT LUONG VALUES ('L0009', '20231101', 6400000, 'NL005', 'BL005', 'CV006', 'CC0009', 'TN0009', 'NV00009', 0)
INSERT LUONG VALUES ('L0010', '20231101', 6500000, 'NL005', 'BL005', 'CV006', 'CC0010', 'TN0010', 'NV00010', 0)

GO
--STORE PROCEDURE
CREATE PROCEDURE usp_XoaChamCong
    @MaNhanVienCanXoa NVARCHAR(50)
AS BEGIN
    SET NOCOUNT ON;

    -- Tắt ràng buộc khóa ngoại trên tất cả các bảng
    EXEC sp_MSforeachtable 'ALTER TABLE ? NOCHECK CONSTRAINT ALL';
    DELETE FROM BOPHANCHAMCONG WHERE MANV = @MaNhanVienCanXoa; 
    -- Bật lại ràng buộc khóa ngoại trên tất cả các bảng
    EXEC sp_MSforeachtable 'ALTER TABLE ? CHECK CONSTRAINT ALL';
END;
GO
CREATE PROCEDURE usp_XoaMaDien
    @MaDien NVARCHAR(50)
AS BEGIN
    SET NOCOUNT ON;

    -- Tắt ràng buộc khóa ngoại trên tất cả các bảng
    EXEC sp_MSforeachtable 'ALTER TABLE ? NOCHECK CONSTRAINT ALL';
    DELETE FROM DIEN WHERE MAD = @MaDien; 
    -- Bật lại ràng buộc khóa ngoại trên tất cả các bảng
    EXEC sp_MSforeachtable 'ALTER TABLE ? CHECK CONSTRAINT ALL';
END;
GO
CREATE PROCEDURE usp_XoaMaNuoc
    @MaNuoc NVARCHAR(50)
AS BEGIN
    SET NOCOUNT ON;

    -- Tắt ràng buộc khóa ngoại trên tất cả các bảng
    EXEC sp_MSforeachtable 'ALTER TABLE ? NOCHECK CONSTRAINT ALL';
    DELETE FROM NUOC WHERE MAN = @MaNuoc; 
    -- Bật lại ràng buộc khóa ngoại trên tất cả các bảng
    EXEC sp_MSforeachtable 'ALTER TABLE ? CHECK CONSTRAINT ALL';
END;
GO
CREATE PROCEDURE CalculateSalary
   @MaNhanVien NVARCHAR(10)
AS BEGIN
    SELECT
        ((LUONG.LUONGCOBAN * BACLUONG.HESOBL) + 
        (LUONG.LUONGCOBAN * CHUCVU.HESOPHUCAP * 0.1) - 
        (ISNULL(TIENNHA.TONGTIEN, 0) + 
        (BOPHANCHAMCONG.SONGAYNGHIBHXH * LUONG.LUONGCOBAN * 0.1) + 
        (BOPHANCHAMCONG.SONGAYNGHIKHONGLYDO * LUONG.LUONGCOBAN * 0.3))) AS TongLuong
    FROM LUONG
    JOIN NGACHLUONG
        ON LUONG.MANL = NGACHLUONG.MANL
    JOIN BACLUONG
        ON LUONG.MABL = BACLUONG.MABL
    JOIN CHUCVU
        ON LUONG.MACV = CHUCVU.MACV
    JOIN BOPHANCHAMCONG
        ON LUONG.MACC = BOPHANCHAMCONG.MACC
    JOIN TIENNHA
        ON LUONG.MATN = TIENNHA.MANTT
    WHERE LUONG.MANV = @MaNhanVien;
END
GO

--Function
CREATE FUNCTION dbo.CheckMACCAndMANVexists (
    @MANV VARCHAR(10),
    @MACC VARCHAR(10)
)
RETURNS BIT
AS BEGIN
    DECLARE @Result BIT;

    IF EXISTS (SELECT 1 FROM NHANVIEN WHERE MANV = @MANV) BEGIN
        IF EXISTS (SELECT 1 FROM BOPHANCHAMCONG WHERE MANV = @MANV AND MACC = @MACC) BEGIN
            SET @Result = 1; -- MANV và MACC tồn tại
        END
        ELSE BEGIN
            SET @Result = 0; -- MANV tồn tại, nhưng MACC không tồn tại
        END
    END
    ELSE BEGIN
        SET @Result = 0; -- MANV không tồn tại
    END

    RETURN @Result;
END;

	